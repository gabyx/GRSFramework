<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8"/>
    <title>GRSFramework by gabyx</title>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    
    <link rel="stylesheet" type="text/css" href="stylesheets/normalize.css" media="screen"/>
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'/>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen"/>
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen"/>
    
    <!--VideJs-->
    <link href="http://vjs.zencdn.net/5.8.0/video-js.css" rel="stylesheet"/>
    <script src="http://vjs.zencdn.net/5.8.0/video.js"></script>
    <!-- If you'd like to support IE8 -->
    <script src="http://vjs.zencdn.net/ie8/1.1.2/videojs-ie8.min.js"></script>
    
    <!--Jquery-->
    <script src="http://code.jquery.com/jquery-2.2.2.min.js" crossorigin="anonymous"></script>
    
    <!--highlight and marked-->
    <link rel="stylesheet" href="http://cdn.jsdelivr.net/highlight.js/9.3.0/styles/default.min.css">
    <script src="http://cdn.jsdelivr.net/highlight.js/9.3.0/highlight.min.js"></script>
    <script src="node_modules/marked/lib/marked.js"></script>
    
    <!--Sidr Panel-->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/sidr/2.2.1/stylesheets/jquery.sidr.light.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/sidr/2.2.1/jquery.sidr.min.js"></script>
    
    
    <!--MathJax Panel-->
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        showProcessingMessages: true,
        tex2jax: { inlineMath: [['$','$'],['\\(','\\)']] }
      });
    </script>
    <script type="text/javascript" async
      src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_CHTML">
    </script>
    
    <script>
        var MathJaxRenderer = {
          
          mjRunning: false,  // true when MathJax is processing
          buffer : null,
          div : null,
          
          doneCallBack : null,
          
          Init: function (text, divId, doneCallBack) {
              this.buffer = text;
              this.div = document.getElementById(divId);
              this.doneCallBack = doneCallBack;
          },

          //  Creates the preview and runs MathJax on it.
          //  If MathJax is already trying to render the code, return
          //  If the text hasn't changed, return
          //  Otherwise, indicate that MathJax is running, and start the
          //    typesetting.  After it is done, call PreviewDone.
          //  
          RenderMath: function () {
            console.log("MathJaxRenderer.RenderMath()");
            var text = this.Escape(this.buffer);                       //Escape tags before doing stuff
            this.buffer = text;
            this.mjRunning = true;
            MathJax.Hub.Queue(
              ["Typeset",MathJax.Hub,  this.buffer],
              ["PreviewDone",this],
              ["resetEquationNumbers", MathJax.InputJax.TeX]
            );
          },

          //
          //  Indicate that MathJax is no longer running,
          //  do markdown over MathJax's result, 
          //  and swap the buffers to show the results.
          //
          PreviewDone: function () {
            console.log("MathJaxRenderer.PreviewDone()");
            this.mjRunning = false;
            // replace occurrences of &gt; at the beginning of a new line
            // with > again, so Markdown blockquotes are handled correctly
            text = this.buffer.replace(/^&gt;/mg, '>');
            this.div.innerHTML = marked(text);
            
            if( this.doneCallBack ){
              this.doneCallBack();
            }
            
          },

          Escape: function (html, encode) { 
             return html
              .replace(!encode ? /&(?!#?\w+;)/g : /&/g, '&amp;')
              .replace(/</g, '&lt;')
              .replace(/>/g, '&gt;')
              .replace(/"/g, '&quot;')
             .replace(/'/g, '&#39;');
          },
          
        };

    </script>

  </head>
  
  
  
  <body>

    <div style="display:none">
        <div id="videoStorage">
            <a id="videoTarget">
            <div id="videoTitle"></div>
            </a>
            <table>
                <tr>
                    <td>
                    <iframe src="https://player.vimeo.com/video/160352926?title=0&byline=0" width="360" height="202" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe>
                    <a href="https://github.com/gabyx/GRSFramework/wiki/videos/Avalanche-P-9Tracking.mp4">
                        Avalanche-P-9Tracking</a>
                    </td>
                    <td>
                         <iframe src="https://player.vimeo.com/video/160352927?title=0&byline=0" width="360" height="202" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe>
                    <a href="https://github.com/gabyx/GRSFramework/wiki/videos/Avalanche-P-9Tracking.mp4">
                        Avalanche-P-9TrackingProcs</a>
                    </td>
                </tr>
                <tr>
                    <td>
                        <iframe src="https://player.vimeo.com/video/160352928?title=0&byline=0" width="360" height="202" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe>
                    <a href="https://github.com/gabyx/GRSFramework/wiki/videos/Avalanche-P-9Tracking.mp4">
                        Avalanche-P-9CloseUpColored</a>
                    </td>
                    <td>
                        <iframe src="https://player.vimeo.com/video/160352925?title=0&byline=0" width="360" height="202" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe>
                    <a href="https://github.com/gabyx/GRSFramework/wiki/videos/Avalanche-P-9Tracking.mp4">
                        SimVsCIV-VelocityMag-P-9</a>
                    </td>
                </tr>
            </table>
            <div id="videoSubtitle"></div>
        </div>
    </div>

    <section class="page-header">
      <h1 class="project-name">GRSFramework</h1>
      <h2 class="project-tagline">efficient research tools to simulate <b>non-smooth granular rigid body dynamics</b>. </h2>
      <a href="https://github.com/gabyx/GRSFramework" class="btn">View on GitHub</a>
      <a href="https://github.com/gabyx/GRSFramework/zipball/master" class="btn">Download .zip</a>
      <a href="https://github.com/gabyx/GRSFramework/tarball/master" class="btn">Download .tar.gz</a>
    </section>

    <section class="main-content">

      <div id="content"></div>
      
      <div style="display:none">
      <div id="toc">
        <h1 id="table-of-contents">Table of Contents</h1>
        <ul id="toc-level1"></ul>
      </div>
      </div>
      
      <footer class="site-footer">
        <span class="site-footer-owner"><a href="https://github.com/gabyx/GRSFramework">GRSFramework</a> is maintained by <a href="https://github.com/gabyx">gabyx</a>.</span>

        <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the <a href="https://github.com/jasonlong/cayman-theme">Cayman theme</a> by <a href="https://twitter.com/jasonlong">Jason Long</a>.</span>
      </footer>

    </section>


  <a id="toc-button" class="btn" href="#sidr-toc">
    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="12" viewBox="0 0 18 12">
      <path fill="currentColor" d="M0 0h18v2H0zM0 5h18v2H0zM0 10h18v2H0z"/>
    </svg>
  </a>

  <script>
    
    marked.setOptions({
      renderer: new marked.Renderer(),
      gfm: true,
      tables: true,
      breaks: false,
      pedantic: false,
      sanitize: false, // IMPORTANT, because we do MathJax before markdown,
                       //            however we do escaping in 'CreatePreview'.
      smartLists: true,
      smartypants: false,
      highlight: function(code) {
        return hljs.highlightAuto(code).value;
      }
    });

    // load video subtitles
    jQuery.get('videoSubtitle.md',function(data){
      $("#videoSubtitle").html(  marked(data) );
    });

  // load wiki Home markup -> render mathjax -> render markdown -> replace videos -> parse/apply toc
  {
    var client1 = new XMLHttpRequest();
    console.log("Get Home.md");
    client1.open('GET', "https://rawgit.com/wiki/gabyx/GRSFramework/Home.md");
    client1.onreadystatechange = function() {
        if(client1.readyState == 4){
              //console.log("Got Home.md")
              //MathJaxRenderer.Init(
                //client1.responseText,
                //'content',
                //function(){
                  
                  //console.log("replace videos");
                  //// replace videos with storage
                  //var vidS=$("#videoStorage");
                  //$("#videos").replaceWith( vidS );
                  
                  //// parse TOC and apply
                  //console.log("parse/apply TOC");
                  //parseTOC('#content','#toc-level1')
                  //applyTOC('#toc-button','#toc');
                //}
              //);
              
            //MathJaxRenderer.RenderMath();
            
            console.log("Got Home.md")
            document.getElementById('content').innerHTML = marked(client1.responseText);
            // replace videos with storage
            console.log("replace videos");
            var vidS=$("#videoStorage");
            $("#videos").replaceWith( vidS );
            console.log("parse/apply TOC");
            document.getElementById('videoTitle').innerHTML = marked("## Videos");
            parseTOC('#content','#toc-level1')
            applyTOC('#toc-button','#toc');
            
            console.log("update mathjax");
            MathJax.Hub.Typeset();
            
        }
    }
    client1.send();
  }
  //{
    //// load table of content
    //var client2 = new XMLHttpRequest();
    //client2.open('GET', "https://rawgit.com/wiki/gabyx/GRSFramework/_Sidebar.md");
    //client2.onreadystatechange = function() {
        //if(client2.readyState == 4){
              //document.getElementById('toc2').innerHTML = marked(client2.responseText);
              
        //}
    //}
    //client2.send();
  //}
  
  function parseTOC(from, to) {
    // parse in the TOC from marked markdown text
    var tocPlaceholder = $(to);
    var staticContent = $(from);
    
    staticContent.find('h1').each(function() {
      tocPlaceholder.append('<li id="'+ $(this).attr('id') + '-menu"><a href="#' + $(this).attr('id') + '">' + $(this).html() + '</li>');
    });
    staticContent.find('h2').each(function() {
      prevTitle = tocPlaceholder.find('#' + $(this).prevAll('h1').first().attr('id') + '-menu');
      prevTitle.not(":has(ul)").append('<ul></ul>');
      prevTitle.find('ul').append('<li id="'+ $(this).attr('id') + '-menu"><a href="#' + $(this).attr('id') + '">' + $(this).html() + '</li>');
    });
  }

  function applyTOC(buttonSel,srcSel) {
    
    var set = false,
    $button = $(buttonSel).sidr({
      name: 'sidr-toc',
      source: srcSel
    });
    
    var startOffset = 360;
    
    $(window).scroll(function() {
      var top = window.scrollY;
      if (top > startOffset && !set) {
        // make TOC button dark when it leaves the header
        $button[0].classList.add('darker');
        set = true;
      } else if (top < startOffset && set) {
        $button[0].classList.remove('darker');
        set = false;
      }
    });
  };
  

  
  </script>

  </body>
</html>
