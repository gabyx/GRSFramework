\ProvidesPackage{MathMacros}[math style definitions]
\RequirePackage{xstring}
\RequirePackage{xparse}
\RequirePackage{xargs}
\RequirePackage{xifthen}% provides \isempty test

\RequirePackage{graphics}

\RequirePackage{tikz}
\usetikzlibrary{calc}

% Left Subscripts
\RequirePackage{leftidx}

% Math
\RequirePackage{amsfonts}
\RequirePackage{amssymb}
\RequirePackage[]{amsmath}
\RequirePackage{accents}

% \usepackage[math-style=I,bold-style=TeX,vargreek-shape=TeX]{unicode-math} % if Xelatex
% 
% %\setmathfont{xits-math.otf}
%  \setmathfont{latinmodern-math.otf} % if Xelatex

% \RequirePackage[geometry]{ifsym}
% \RequirePackage{wasysym}
\RequirePackage{bbm}
% \RequirePackage{mathrsfs}
% \RequirePackage{pifont}
%\RequirePackage{bm}


% Vector and Matrices ======================================================================
\newcommand{\vect}[1]{\mathbf{#1}}
\newcommand{\mat}[1]{\mathbf{#1}}

%Normal dots for scalars only
\newcommand{\dt}[1]{%
    \accentset{\mbox{.}}{#1}}
\newcommand{\dtt}[1]{%
    \accentset{\mbox{.\hspace{-0.25ex}.}}{#1}}

%Bold dots used only in macros dvect, dmat
\newcommand{\dottb}[1]{%
    \accentset{\mbox{\bfseries .}}{#1}}
\newcommand{\dotttb}[1]{%
    \accentset{\mbox{\bfseries .\hspace{-0.25ex}.}}{#1}}

%   \newcommand{\dotr}[1]{%
%   #1\accentset{\mbox{\bfseries .}}{\vphantom{#1}}}
%   

%Bullet dot after bracket!
\makeatletter
\newcommand{\dotr}[1]{%
    \mathpalette\@dotr{#1}%
}
\newcommand*{\@dotr}[2]{%
    \sbox0{$\m@th#1#2$}%
    \usebox{0}%
    % simulating a superscript
    \raisebox{\dimexpr\ht0-\height}{$\m@th#1\@smallbullet#1\bullet$}%
    \kern\scriptspace
}
\newcommand*{\@smallbullet}[2]{%
    \scalebox{.4}{$\m@th#1#2$}%
}
\makeatother
%===========================

\newcommand{\overbar}[1]{\mkern 1.5mu\overline{\mkern-1.5mu#1\mkern-1.5mu}\mkern 1.5mu}
\newcommand{\dmat}[1]{\dottb{\mat{#1}}}
% \newcommand{\tmat}[1]{\mathrlap{\kern 0.45ex \tilde{\phantom{#1}}}\mat{#1}}
% \newcommand{\dtmat}[1]{\mathrlap{\kern 0.45ex \dottb{\tilde{\phantom{#1}}}}\mat{#1}}
\newcommand{\tmat}[1]{\mat{\tilde{#1}}}
\newcommand{\dtmat}[1]{\mat{\dottb{\tilde{#1}}}}
\newcommand{\dvect}[1]{\vect{\dottb{#1}}}
\newcommand{\ddvect}[1]{\vect{\dotttb{#1}}}
\newcommand{\tvect}[1]{\vect{\tilde{#1}}}
\newcommand{\hvect}[1]{{\vect{\hat{#1}}}}
\newcommand{\bvect}[1]{{\vect{\overbar{#1}}}}
\newcommand{\hmat}[1]{{\mat{\hat{#1}}}}
\newcommand{\bmat}[1]{{\mat{\overbar{#1}}}}

% Some shortcuts vor matrices and vectors =============================

% %bold latin vectors
\newcommand{\va}{\vect{a}}
\newcommand{\vb}{\vect{b}}
\newcommand{\vc}{\vect{c}}
\newcommand{\vd}{\vect{d}}
\newcommand{\ve}{\vect{e}}
\newcommand{\vf}{\vect{f}}
\newcommand{\vg}{\vect{g}}
\newcommand{\vh}{\vect{h}}
\newcommand{\vi}{\vect{i}}
\newcommand{\vj}{\vect{j}}
\newcommand{\vk}{\vect{k}}
\newcommand{\vl}{\vect{l}}
\newcommand{\vm}{\vect{m}}
\newcommand{\vn}{\vect{n}}
\newcommand{\vo}{\vect{o}}
\newcommand{\vp}{\vect{p}}
\newcommand{\vq}{\vect{q}}
\newcommand{\vr}{\vect{r}}
\newcommand{\vs}{\vect{s}}
\newcommand{\vt}{\vect{t}}
\newcommand{\vu}{\vect{u}}
\newcommand{\vv}{\vect{v}}
\newcommand{\vw}{\vect{w}}
\newcommand{\vx}{\vect{x}}
\newcommand{\vy}{\vect{y}}
\newcommand{\vz}{\vect{z}}
\newcommand{\vOne}{\vect{1}}
% 
% %bold capital latin vectors
\newcommand{\vA}{\vect{A}}
\newcommand{\vB}{\vect{B}}
\newcommand{\vC}{\vect{C}}
\newcommand{\vD}{\vect{D}}
\newcommand{\vE}{\vect{E}}
\newcommand{\vF}{\vect{F}}
\newcommand{\vG}{\vect{G}}
\newcommand{\vH}{\vect{H}}
\newcommand{\vI}{\vect{I}}
\newcommand{\vJ}{\vect{J}}
\newcommand{\vK}{\vect{K}}
\newcommand{\vL}{\vect{L}}
\newcommand{\vM}{\vect{M}}
\newcommand{\vN}{\vect{N}}
\newcommand{\vO}{\vect{O}}
\newcommand{\vP}{\vect{P}}
\newcommand{\vQ}{\vect{Q}}
\newcommand{\vR}{\vect{R}}
\newcommand{\vS}{\vect{S}}
\newcommand{\vT}{\vect{T}}
\newcommand{\vU}{\vect{U}}
\newcommand{\vV}{\vect{V}}
\newcommand{\vW}{\vect{W}}
\newcommand{\vX}{\vect{X}}
\newcommand{\vY}{\vect{Y}}
\newcommand{\vZ}{\vect{Z}}
% 
%bold greek  vectors
%bold greek  vectors
\newcommand{\val}{\boldsymbol{\alpha}}
\newcommand{\vbe}{\boldsymbol{\beta}}
\newcommand{\vga}{\boldsymbol{\gamma}}
\newcommand{\vde}{\boldsymbol{\delta}}
\newcommand{\vep}{\boldsymbol{\epsilon}}
\newcommand{\vze}{\boldsymbol{\zeta}}
\newcommand{\vet}{\boldsymbol{\eta}}
\newcommand{\vth}{\boldsymbol{\theta}}
\newcommand{\vio}{\boldsymbol{\iota}}
\newcommand{\vka}{\boldsymbol{\kappa}}
\newcommand{\vla}{\boldsymbol{\lambda}}
\newcommand{\vmu}{\boldsymbol{\mu}}
\newcommand{\vnu}{\boldsymbol{\nu}}
\newcommand{\vxi}{\boldsymbol{\xi}}
\newcommand{\vpi}{\boldsymbol{\pi}}
\newcommand{\vrh}{\boldsymbol{\rho}}
\newcommand{\vsi}{\boldsymbol{\sigma}}
\newcommand{\vta}{\boldsymbol{\tau}}
\newcommand{\vup}{\boldsymbol{\upsilon}}
\newcommand{\vph}{\boldsymbol{\varphi}}
\newcommand{\vch}{\boldsymbol{\chi}}
\newcommand{\vps}{\boldsymbol{\psi}}
\newcommand{\vom}{\boldsymbol{\omega}}

\newcommand{\vvep}{\boldsymbol{\varepsilon}}
\newcommand{\vvth}{\boldsymbol{\vartheta}}
\newcommand{\vvrh}{\boldsymbol{\varrho}}
\newcommand{\vvpi}{\boldsymbol{\varpi}}
\newcommand{\vvsi}{\boldsymbol{\varsigma}}
\newcommand{\vvph}{\boldsymbol{\phi}}

%bold capital greek vectors
\newcommand{\vGa}{\vect{\Gamma}}
\newcommand{\vDe}{\vect{\Delta}}
\newcommand{\vTh}{\vect{\Theta}}
\newcommand{\vLa}{\vect{\Lambda}}
\newcommand{\vXi}{\vect{\Xi}}
\newcommand{\vPi}{\vect{\Pi}}
\newcommand{\vSi}{\vect{\Sigma}}
\newcommand{\vUp}{\vect{\Upsilon}}
\newcommand{\vPh}{\vect{\Phi}}
\newcommand{\vPs}{\vect{\Psi}}
\newcommand{\vOm}{\vect{\Omega}}

% matrices
\newcommand{\mma}{\mat{a}}
\newcommand{\mmb}{\mat{b}}
\newcommand{\mmc}{\mat{c}}
\newcommand{\mmd}{\mat{d}}
\newcommand{\mme}{\mat{e}}
\newcommand{\mmf}{\mat{f}}
\newcommand{\mmg}{\mat{g}}
\newcommand{\mmh}{\mat{h}}
\newcommand{\mmi}{\mat{i}}
\newcommand{\mmj}{\mat{j}}
\newcommand{\mmk}{\mat{k}}
\newcommand{\mml}{\mat{l}}
\newcommand{\mmm}{\mat{m}}
\newcommand{\mmn}{\mat{n}}
\newcommand{\mmo}{\mat{o}}
\newcommand{\mmp}{\mat{p}}
\newcommand{\mmq}{\mat{q}}
\newcommand{\mmr}{\mat{r}}
\newcommand{\mms}{\mat{s}}
\newcommand{\mmt}{\mat{t}}
\newcommand{\mmu}{\mat{u}}
\newcommand{\mmv}{\mat{v}}
\newcommand{\mmw}{\mat{w}}
\newcommand{\mmx}{\mat{x}}
\newcommand{\mmy}{\mat{y}}
\newcommand{\mmz}{\mat{z}}
\newcommand{\mmOne}{\mat{1}}
% 
% %bold capital latin matrices
\newcommand{\mmA}{\mat{A}}
\newcommand{\mmB}{\mat{B}}
\newcommand{\mmC}{\mat{C}}
\newcommand{\mmD}{\mat{D}}
\newcommand{\mmE}{\mat{E}}
\newcommand{\mmF}{\mat{F}}
\newcommand{\mmG}{\mat{G}}
\newcommand{\mmH}{\mat{H}}
\newcommand{\mmI}{\mat{I}}
\newcommand{\mmJ}{\mat{J}}
\newcommand{\mmK}{\mat{K}}
\newcommand{\mmL}{\mat{L}}
\newcommand{\mmM}{\mat{M}}
\newcommand{\mmN}{\mat{N}}
\newcommand{\mmO}{\mat{O}}
\newcommand{\mmP}{\mat{P}}
\newcommand{\mmQ}{\mat{Q}}
\newcommand{\mmR}{\mat{R}}
\newcommand{\mmS}{\mat{S}}
\newcommand{\mmT}{\mat{T}}
\newcommand{\mmU}{\mat{U}}
\newcommand{\mmV}{\mat{V}}
\newcommand{\mmW}{\mat{W}}
\newcommand{\mmX}{\mat{X}}
\newcommand{\mmY}{\mat{Y}}
\newcommand{\mmZ}{\mat{Z}}
% 
%bold greek  matrices
\newcommand{\mmal}{\mbox{\boldmath $\alpha$}}
\newcommand{\mmbe}{\mbox{\boldmath $\beta$}}
\newcommand{\mmga}{\mbox{\boldmath $\gamma$}}
\newcommand{\mmde}{\mbox{\boldmath $\delta$}}
\newcommand{\mmep}{\mbox{\boldmath $\epsilon$}}
\newcommand{\mmze}{\mbox{\boldmath $\zeta$}}
\newcommand{\mmet}{\mbox{\boldmath $\eta$}}
\newcommand{\mmth}{\mbox{\boldmath $\theta$}}
\newcommand{\mmio}{\mbox{\boldmath $\iota$}}
\newcommand{\mmka}{\mbox{\boldmath $\kappa$}}
\newcommand{\mmla}{\mbox{\boldmath $\lambda$}}
\newcommand{\mmmu}{\mbox{\boldmath $\mu$}}
\newcommand{\mmnu}{\mbox{\boldmath $\nu$}}
\newcommand{\mmxi}{\mbox{\boldmath $\xi$}}
\newcommand{\mmpi}{\mbox{\boldmath $\pi$}}
\newcommand{\mmrh}{\mbox{\boldmath $\rho$}}
\newcommand{\mmsi}{\mbox{\boldmath $\sigma$}}
\newcommand{\mmta}{\mbox{\boldmath $\tau$}}
\newcommand{\mmup}{\mbox{\boldmath $\upsilon$}}
\newcommand{\mmph}{\mbox{\boldmath $\varphi$}}
\newcommand{\mmch}{\mbox{\boldmath $\chi$}}
\newcommand{\mmps}{\mbox{\boldmath $\psi$}}
\newcommand{\mmom}{\mbox{\boldmath $\omega$}}

\newcommand{\mmvep}{\mbox{\boldmath $\varepsilon$}}
\newcommand{\mmvth}{\mbox{\boldmath $\vartheta$}}
\newcommand{\mmvrh}{\mbox{\boldmath $\varrho$}}
\newcommand{\mmvpi}{\mbox{\boldmath $\varpi$}}
\newcommand{\mmvsi}{\mbox{\boldmath $\varsigma$}}
\newcommand{\mmvph}{\mbox{\boldmath $\phi$}}

%bold capital greek matrices
\newcommand{\mmGa}{\mat{\Gamma}}
\newcommand{\mmDe}{\mat{\Delta}}
\newcommand{\mmTh}{\mat{\Theta}}
\newcommand{\mmLa}{\mat{\Lambda}}
\newcommand{\mmXi}{\mat{\Xi}}
\newcommand{\mmPi}{\mat{\Pi}}
\newcommand{\mmSi}{\mat{\Sigma}}
\newcommand{\mmUp}{\mat{\Upsilon}}
\newcommand{\mmPh}{\mat{\Phi}}
\newcommand{\mmPs}{\mat{\Psi}}
\newcommand{\mmOm}{\mat{\Omega}}


% ==========================================================


% capital greek slanted, OHNE amsmath-package
% \newcommand{\iGa}{\mathnormal{\Gamma}}
% \newcommand{\iDe}{\mathnormal{\Delta}}
% \newcommand{\iTh}{\mathnormal{\Theta}}
% \newcommand{\iLa}{\mathnormal{\Lambda}}
% \newcommand{\iXi}{\mathnormal{\Xi}}
% \newcommand{\iPi}{\mathnormal{\Pi}}
% \newcommand{\iSi}{\mathnormal{\Sigma}}
% \newcommand{\iUp}{\mathnormal{\Upsilon}}
% \newcommand{\iPh}{\mathnormal{\Phi}}
% \newcommand{\iPs}{\mathnormal{\Psi}}
% \newcommand{\iOm}{\mathnormal{\Omega}}
% 
% %capital greek slanted, MIT amsmath-package
\newcommand{\iGa}{\varGamma}
\newcommand{\iDe}{\varDelta}
\newcommand{\iTh}{\varTheta}
\newcommand{\iLa}{\varLambda}
\newcommand{\iXi}{\varXi}
\newcommand{\iPi}{\varPi}
\newcommand{\iSi}{\varSigma}
\newcommand{\iUp}{\varUpsilon}
\newcommand{\iPh}{\varPhi}
\newcommand{\iPs}{\varPsi}
\newcommand{\iOm}{\varOmega}

%calligraphic
\newcommand{\cA}{\mathcal{A}}
\newcommand{\cB}{\mathcal{B}}
\newcommand{\cC}{\mathcal{C}}
\newcommand{\cD}{\mathcal{D}}
\newcommand{\cE}{\mathcal{E}}
\newcommand{\cF}{\mathcal{F}}
\newcommand{\cG}{\mathcal{G}}
\newcommand{\cH}{\mathcal{H}}
\newcommand{\cI}{\mathcal{I}}
\newcommand{\cJ}{\mathcal{J}}
\newcommand{\cK}{\mathcal{K}}
\newcommand{\cL}{\mathcal{L}}
\newcommand{\cM}{\mathcal{M}}
\newcommand{\cN}{\mathcal{N}}
\newcommand{\cO}{\mathcal{O}}
\newcommand{\cP}{\mathcal{P}}
\newcommand{\cQ}{\mathcal{Q}}
\newcommand{\cR}{\mathcal{R}}
\newcommand{\cS}{\mathcal{S}}
\newcommand{\cT}{\mathcal{T}}
\newcommand{\cU}{\mathcal{U}}
\newcommand{\cV}{\mathcal{V}}
\newcommand{\cW}{\mathcal{W}}
\newcommand{\cX}{\mathcal{X}}
\newcommand{\cY}{\mathcal{Y}}
\newcommand{\cZ}{\mathcal{Z}}
% 
%roman
\newcommand{\rmA}{\mathrm{A}}
\newcommand{\rmB}{\mathrm{B}}
\newcommand{\rmC}{\mathrm{C}}
\newcommand{\rmD}{\mathrm{D}}
\newcommand{\rmE}{\mathrm{E}}
\newcommand{\rmF}{\mathrm{F}}
\newcommand{\rmG}{\mathrm{G}}
\newcommand{\rmH}{\mathrm{H}}
\newcommand{\rmI}{\mathrm{I}}
\newcommand{\rmJ}{\mathrm{J}}
\newcommand{\rmK}{\mathrm{K}}
\newcommand{\rmL}{\mathrm{L}}
\newcommand{\rmM}{\mathrm{M}}
\newcommand{\rmN}{\mathrm{N}}
\newcommand{\rmO}{\mathrm{O}}
\newcommand{\rmP}{\mathrm{P}}
\newcommand{\rmQ}{\mathrm{Q}}
\newcommand{\rmR}{\mathrm{R}}
\newcommand{\rmS}{\mathrm{S}}
\newcommand{\rmT}{\mathrm{T}}
\newcommand{\rmU}{\mathrm{U}}
\newcommand{\rmV}{\mathrm{V}}
\newcommand{\rmW}{\mathrm{W}}
\newcommand{\rmX}{\mathrm{X}}
\newcommand{\rmY}{\mathrm{Y}}
\newcommand{\rmZ}{\mathrm{Z}}

\newcommand{\rma}{\mathrm{a}}
\newcommand{\rmb}{\mathrm{b}}
\newcommand{\rmc}{\mathrm{c}}
\newcommand{\rmd}{\mathrm{d}}
\newcommand{\rme}{\mathrm{e}}
\newcommand{\rmf}{\mathrm{f}}
\newcommand{\rmg}{\mathrm{g}}
\newcommand{\rmh}{\mathrm{h}}
\newcommand{\rmi}{\mathrm{i}}
\newcommand{\rmj}{\mathrm{j}}
\newcommand{\rmk}{\mathrm{k}}
\newcommand{\rml}{\mathrm{l}}
\newcommand{\rmm}{\mathrm{m}}
\newcommand{\rmn}{\mathrm{n}}
\newcommand{\rmo}{\mathrm{o}}
\newcommand{\rmp}{\mathrm{p}}
\newcommand{\rmq}{\mathrm{q}}
\newcommand{\rmr}{\mathrm{r}}
\newcommand{\rms}{\mathrm{s}}
\newcommand{\rmt}{\mathrm{t}}
\newcommand{\rmu}{\mathrm{u}}
\newcommand{\rmv}{\mathrm{v}}
\newcommand{\rmw}{\mathrm{w}}
\newcommand{\rmx}{\mathrm{x}}
\newcommand{\rmy}{\mathrm{y}}
\newcommand{\rmz}{\mathrm{z}}
% 
%% bb

\newcommand{\bbA}{\mathbb{A}}
\newcommand{\bbB}{\mathbb{B}}
\newcommand{\bbC}{\mathbb{C}}
\newcommand{\bbD}{\mathbb{D}}
\newcommand{\bbE}{\mathbb{E}}
\newcommand{\bbF}{\mathbb{F}}
\newcommand{\bbG}{\mathbb{G}}
\newcommand{\bbH}{\mathbb{H}}
\newcommand{\bbI}{\mathbb{I}}
\newcommand{\bbJ}{\mathbb{J}}
\newcommand{\bbK}{\mathbb{K}}
\newcommand{\bbL}{\mathbb{L}}
\newcommand{\bbM}{\mathbb{M}}
\newcommand{\bbN}{\mathbb{N}}
\newcommand{\bbO}{\mathbb{O}}
\newcommand{\bbP}{\mathbb{P}}
\newcommand{\bbQ}{\mathbb{Q}}
\newcommand{\bbR}{\mathbb{R}}
\newcommand{\bbS}{\mathbb{S}}
\newcommand{\bbT}{\mathbb{T}}
\newcommand{\bbU}{\mathbb{U}}
\newcommand{\bbV}{\mathbb{V}}
\newcommand{\bbW}{\mathbb{W}}
\newcommand{\bbX}{\mathbb{X}}
\newcommand{\bbY}{\mathbb{Y}}
\newcommand{\bbZ}{\mathbb{Z}}

\newcommand{\bba}{\mathbb{a}}
\newcommand{\bbb}{\mathbb{b}}
\newcommand{\bbc}{\mathbb{c}}
\newcommand{\bbd}{\mathbb{d}}
\newcommand{\bbe}{\mathbb{e}}
\newcommand{\bbf}{\mathbb{f}}
\newcommand{\bbg}{\mathbb{g}}
\newcommand{\bbh}{\mathbb{h}}
\newcommand{\bbi}{\mathbb{i}}
\newcommand{\bbj}{\mathbb{j}}
\newcommand{\bbk}{\mathbb{k}}
\newcommand{\bbl}{\mathbb{l}}
\newcommand{\bbm}{\mathbb{m}}
\newcommand{\bbn}{\mathbb{n}}
\newcommand{\bbo}{\mathbb{o}}
\newcommand{\bbp}{\mathbb{p}}
\newcommand{\bbq}{\mathbb{q}}
\newcommand{\bbr}{\mathbb{r}}
\newcommand{\bbs}{\mathbb{s}}
\newcommand{\bbt}{\mathbb{t}}
\newcommand{\bbu}{\mathbb{u}}
\newcommand{\bbv}{\mathbb{v}}
\newcommand{\bbw}{\mathbb{w}}
\newcommand{\bbx}{\mathbb{x}}
\newcommand{\bby}{\mathbb{y}}
\newcommand{\bbz}{\mathbb{z}}
% 
% 
%fraktur
\newcommand{\frA}{\mathfrak{A}}
\newcommand{\frB}{\mathfrak{B}}
\newcommand{\frC}{\mathfrak{C}}
\newcommand{\frD}{\mathfrak{D}}
\newcommand{\frE}{\mathfrak{E}}
\newcommand{\frF}{\mathfrak{F}}
\newcommand{\frG}{\mathfrak{G}}
\newcommand{\frH}{\mathfrak{H}}
\newcommand{\frI}{\mathfrak{I}}
\newcommand{\frJ}{\mathfrak{J}}
\newcommand{\frK}{\mathfrak{K}}
\newcommand{\frL}{\mathfrak{L}}
\newcommand{\frM}{\mathfrak{M}}
\newcommand{\frN}{\mathfrak{N}}
\newcommand{\frO}{\mathfrak{O}}
\newcommand{\frP}{\mathfrak{P}}
\newcommand{\frQ}{\mathfrak{Q}}
\newcommand{\frR}{\mathfrak{R}}
\newcommand{\frS}{\mathfrak{S}}
\newcommand{\frT}{\mathfrak{T}}
\newcommand{\frU}{\mathfrak{U}}
\newcommand{\frV}{\mathfrak{V}}
\newcommand{\frW}{\mathfrak{W}}
\newcommand{\frX}{\mathfrak{X}}
\newcommand{\frY}{\mathfrak{Y}}
\newcommand{\frZ}{\mathfrak{Z}}

\newcommand{\fra}{\mathfrak{a}}
\newcommand{\frb}{\mathfrak{b}}
\newcommand{\frc}{\mathfrak{c}}
\newcommand{\frd}{\mathfrak{d}}
\newcommand{\fre}{\mathfrak{e}}
\newcommand{\frf}{\mathfrak{f}}
\newcommand{\frg}{\mathfrak{g}}
\newcommand{\frh}{\mathfrak{h}}
\newcommand{\fri}{\mathfrak{i}}
\newcommand{\frj}{\mathfrak{j}}
\newcommand{\frk}{\mathfrak{k}}
\newcommand{\frl}{\mathfrak{l}}
\newcommand{\frm}{\mathfrak{m}}
\newcommand{\frn}{\mathfrak{n}}
\newcommand{\fro}{\mathfrak{o}}
\newcommand{\frp}{\mathfrak{p}}
\providecommand{\frq}{\mathfrak{q}}
\newcommand{\frr}{\mathfrak{r}}
\newcommand{\frs}{\mathfrak{s}}
\newcommand{\frt}{\mathfrak{t}}
\newcommand{\fru}{\mathfrak{u}}
\newcommand{\frv}{\mathfrak{v}}
\newcommand{\frw}{\mathfrak{w}}
\newcommand{\frx}{\mathfrak{x}}
\newcommand{\fry}{\mathfrak{y}}
\newcommand{\frz}{\mathfrak{z}}

%%====================================================================================================

\newcommandx{\numberSet}[3][2=,3=]{%
    \ifthenelse{\isempty{#2}}%
    {%
        \mathbb{#1}%
    }%
    {%
        \ifthenelse{\isempty{#3}}%
        {%
            \mathbb{#1}^{#2}%
        }% if #2 is empty
        {%
            \mathbb{#1}^{#2 \times #3}%
        }% if #2 is not empty
    }%
}

% N letter (x in R^n)
\newcommandx{\NNN}[2][2=]{\numberSet{N}[#1][#2]}
% Real letter (x in R^n)
\newcommandx{\RR}[2][2=]{\numberSet{R}[#1][#2]}
% Complex letter (x in C^n)
\newcommandx{\CC}[2][2=]{\numberSet{C}[#1][#2]}
% Extendet Reals
\newcommandx{\extRR}[2][2=]{\overline{\RR{#1}[#2]}}
% Eucledian Vector space E^n
\newcommandx{\EE}[2][2=]{\numberSet{E}[#1][#2]}


% Mapst to 
\newcommand{\maps}{\rightarrow}
\newcommand{\mapss}{\mapsto}


% Special Matrix (SuperScripts) Inverse, Transpose
\newcommand{\inv}{{\scalebox{0.7}[0.7]{-}\scalebox{0.6}[0.5]{$\mathbf{1}$}}}
\newcommand{\transp}{\intercal}
\newcommand{\invT}{{\scalebox{0.7}[0.7]{-}\transp}}

\newcommand{\invM}{{-1}}
\newcommand{\invTM}{{-\top}}
\newcommand{\transpM}{\top}


% Special Derivatives
\newcommand{\dvir}{\delta}
\newcommand{\dvirC}{\underline{\delta}}
\newcommand{\dvirCC}{\underline{\underline{\delta}}}
\newcommand{\diff}[1][]{\mathrm{d}#1}
% Subdifferential
\newcommand{\sdiff}[1][]{\partial#1}
\newcommand{\sdiffx}[2]{\partial_{#2}#1}
\newcommand{\diffv}[1][]{\vd#1}
\newcommand{\D}[1][]{\mathrm{D}#1}
\newcommand{\dd}[2]{\frac{\diff #1}{\diff #2}}
\newcommand{\pp}[2]{\frac{\partial #1}{\partial #2}}
\newcommand{\DD}[2]{\frac{\D #1}{\D #2}}

%\newcommand{\ocirc}[1]{\buildrel _{\circ} \over {\mathbf{#1}}}

% Sepcial Mathematica Operators and Function (Mechanics Related) 
\newcommand{\deta}{\textnormal{d}\eta}
\DeclareMathOperator*{\argmin}{\mathrm{argmin}}
\newcommand{\Upr}{{\mathop{\mathrm{Upr}}}}
\newcommand{\Sgn}{{\mathop{\mathrm{Sgn}}}}
\newcommand{\Det}{{\mathop{\mathrm{Det}}}}
\newcommand{\Trace}{\mathop{\mathrm{Tr}}}
\newcommandx{\indic}[2][2=]{%
    \ifthenelse{\isempty{#2}}%
    {%
        I_{#1}%
    }% if #1 is empty
    {%
        I_{#1}(#2)%
    }% if #1 is not empty
}


\newcommand{\abs}{\mathop{\mathrm{abs}}}
\newcommand{\diag}[1]{\mathop{\mathbf{diag}\left(#1\right)}}
\newcommand{\vZero}{{\mathbf{0}}}
\newcommand{\dbar}[1]{\Bar{\Bar{#1}}}


% Linear Spaces
\newcommand{\basvec}[1]{\dbar{\ve}^{#1}}
\newcommand{\basvecd}[1]{\dbar{\vvep}^{#1}}
\newcommand{\field}[1]{\mathbb{#1}}
\newcommand{\fieldD}[1]{\mathbb{#1}^{*}}
\newcommand{\linsp}[1]{{#1}}
\newcommand{\linspdual}[1]{#1^\ast}
\newcommand{\linspdualdual}[1]{#1^{\ast\ast}}
\newcommand{\dimsp}[2]{\mathrm{dim}_{#1}(\linsp{#2})}
\newcommand{\genmap}[1]{\mathcal{#1}}
\newcommand{\linmap}[1]{\mathcal{#1}}
\newcommand{\cormap}{\linmap{K}}

\newcommand{\conj}[1]{\overbar{#1}}
\newcommand{\conjtransp}[1]{#1^{*}}

\newcommand{\quat}[1]{\mat{#1}}
\newcommand{\quatvec}[1]{\vect{#1}}
\newcommand{\quatImPart}[1]{\vect{#1}_{I}}
\newcommand{\dquat}[1]{\dot{\quat{#1}}}
\newcommand{\tquat}[1]{\tilde{\quat{#1}}}
\newcommand{\dtquat}[1]{\dot{\tilde{\quat{#1}}}}
\newcommand{\quatconj}{^\ast}
\newcommand{\cquat}[1]{{\quat{#1}\quatconj}}
\newcommand{\dcquat}[1]{{\dot{\quat{#1}}\quatconj}}
\renewcommand{\Re}{\mathop{\mathrm{Re}}}
\renewcommand{\Im}{\mathop{\mathrm{Im}}}
\newcommand{\quatMultMap}{\linmap{\varphi}}
\newcommand{\quatMult}{\boldsymbol{\varphi}}
\newcommand{\quatCoorMap}{\cormap}
\newcommand{\newquat}[2]{\mathinner{\{ #1 \, , \, #2 \}}}
\newcommand{\quatnorm}[1]{\norm{#1}[]}
% SO3
\newcommand{\SO}[1]{\mathit{SO}(#1)}
\newcommand{\SOThree}{\SO{3}}


% Derivatives
\newcommand{\dirder}[2]{D_{#2}\!\left[#1\right]}
\newcommand{\grad}[1]{\nabla#1}

\newcommand{\gradat}[2]{\grad{#1}(#2)}
\newcommand{\gradatA}[2]{\grad{#1}_{#2}}

% partial
\newcommand{\partialdf}[1]{\diff{f}(#1)}
\newcommand{\partialdfA}[1]{\diff{\mathrm{f}}_{\mathrm{#1}}}
\newcommand{\vpartialdf}[1]{\diffv{\vf}(#1)}
\newcommand{\vpartialdfA}[1]{\diffv{\vf}_{#1}}

%normal cone
\newcommand{\NCone}[1]{\cN_{#1}}
\newcommand{\NConeAt}[2]{\NCone{#1}\left(#2\right)}


\newcommand{\epi}[1]{\mathrm{epi}(#1)}

\newcommand{\emptyS}{\{\}}

% prox function
\newcommand{\vprox}{\mathbf{prox}}

\newcommandx{\prox}[2][2=]{%
    \ifthenelse{\isempty{#2}}%
    {%
        \mathrm{prox}_{#1}%
    }% if #1 is empty
    {%
        \mathrm{prox}_{#1}^{#2}%
    }% if #1 is not empty
}


% inner product
\newcommand{\langl}{\begin{picture}(4.5,7)
    \put(1.1,2.5){\rotatebox{60}{\line(1,0){5.5}}}
    \put(1.1,2.5){\rotatebox{300}{\line(1,0){5.5}}}
    \end{picture}}
\newcommand{\rangl}{\begin{picture}(4.5,7)
    \put(.9,2.5){\rotatebox{120}{\line(1,0){5.5}}}
    \put(.9,2.5){\rotatebox{240}{\line(1,0){5.5}}}
    \end{picture}}
\newcommand{\lang}{\begin{picture}(5,7)
    \put(1.1,2.5){\rotatebox{45}{\line(1,0){6.0}}}
    \put(1.1,2.5){\rotatebox{315}{\line(1,0){6.0}}}
    \end{picture}}
\newcommand{\rang}{\begin{picture}(5,7)
    \put(.1,2.5){\rotatebox{135}{\line(1,0){6.0}}}
    \put(.1,2.5){\rotatebox{225}{\line(1,0){6.0}}}
    \end{picture}}
% \newcommandx{\inpr}[2]{%
%     \left\langle #1 \, , \, #2 \right\rangle
% }


% InnerProduct Bracket Notation
\RequirePackage{mathtools}
\DeclarePairedDelimiterX{\innerprTWO}[2]{\lparen}{\rparen}{#1\,\delimsize\vert\,#2}

\ExplSyntaxOn
\NewDocumentCommand \innerpr { m m o }
{
    \IfNoValueTF{#3}{%
        \innerprTWO{#1}{#2}
    }%
    {%
        \innerprTWO{#1}{#2}\sb{#3}
    }%
}
\ExplSyntaxOff

% InnerProduct Matrix Notation
\ExplSyntaxOn
\NewDocumentCommand \innerprM { m m o}
{
    \IfNoValueTF{#3}{%
        #1^{\transpM}#2%
    }%
    {%
        \IfStrEq{#3}{I}{{#1}^{\transpM}{#2}}{{#1}^{\transpM} \mat{#3} {#2}}
    }%
}
\ExplSyntaxOff


% DualPariing Bracket Notation
\DeclarePairedDelimiterX{\dualp}[2]{\langle}{\rangle}{#1\,\delimsize\vert\,#2}
%% Norm
\ExplSyntaxOn
\NewDocumentCommand \norm { m o}{
    \IfNoValueTF{#2}{
        \left\| #1\right\|\sb{2}%
    } %
    {%
        \left\| #1\right\|\sb{#2}%
    }%
}
\ExplSyntaxOff





% TENSOR STUFF ==================================================
% Write Tensorkoordinates  
% \NewDocumentCommand{\tenskor}{m >{\SplitList{,}}O{} o}
% {\begingroup%
%   \IfNoValueTF{#3}{%
%     #1%
%     \newcommand{\pobj}{#1}%
%   }{%
%     #1#3%
%     \newcommand{\pobj}{#1#3}%
%   }%
%     \newcommand\object{\vphantom{\pobj}}%
%     \ProcessList{#2}{\dotensorkor}%
% \endgroup}%
% 
% 
% \NewDocumentCommand{\dotensorkor}{m}
%  {%
%   \object#1%
%  }
% 
%  
%  % Sloppy version of Tensorkoordinates
%  \NewDocumentCommand{\tenskors}{m >{\SplitList{,}}O{}}
%  {\begingroup%
%    #1%
%    \ProcessList{#2}{\dotensorkors}%
%  \endgroup}%
% \NewDocumentCommand{\dotensorkors}{m}
%  {%
%   {#1}%
%  }
%  


\newcommand{\tensprod}{\otimes}

% Tensor Syntax =====================================================
\ExplSyntaxOn
\NewDocumentCommand{\tenskor}{ s m O{} o}
{
    \IfBooleanTF{#1}
    { \gabriel_nonstacked:nn { #2 } { #3 } { #4 } }
    { \gabriel_stacked:nn { #2 } { #3 } { #4 } }
}

\cs_new_protected:Npn \gabriel_stacked:nn #1 #2 #3
{
    \IfNoValueTF{#3}{%
        #1%
        \def\pobj{#1}%
    }{%
    {#1#3}%
    \def\pobj{#1#3}%
}%
\clist_map_inline:nn { #2 }
{
    \vphantom{\pobj} ##1
}
}

\tl_new:N \l_gabriel_sup_tl
\tl_new:N \l_gabriel_sub_tl

\cs_new_protected:Npn \gabriel_nonstacked:nn #1 #2 #3
{
    \tl_clear:N \l_gabriel_sup_tl
    \tl_clear:N \l_gabriel_sub_tl
    \clist_map_inline:nn { #2 }
    {
        \gabriel_decide:Nn ##1
    }
    \IfNoValueTF{#3}{%
        #1%
    }{%
    #1#3%
}%
\sp{\l_gabriel_sup_tl}\sb{\l_gabriel_sub_tl}
}

\cs_new_protected:Npn \gabriel_decide:Nn #1 #2
{
    \token_if_math_superscript:NTF #1
    {
        \tl_put_right:Nn \l_gabriel_sup_tl { #2 }
    }
    {
        \tl_put_right:Nn \l_gabriel_sub_tl { #2 }
    }
}

\ExplSyntaxOff
% ================================================================


% Kroenecker Delta
\newcommand{\kroen}[1]{\tenskor{\delta}[#1]}




% Statistics
\newcommand{\Var}[1]{{\mathop{\mathrm{Var}}\!\left[#1\right]}}
\newcommand{\Mean}[1]{{\mathrm{E}\!\left[#1\right]}}
\newcommand{\Median}[1]{{\mathrm{Med}\!\left[#1\right]}}


% Big O Notation 
\ExplSyntaxOn
\NewDocumentCommand \bigO { m }
{
    \IfNoValueTF{#1}{%
        \mathop{\mathcal{O}}%
    }%
    {%
        \mathop{\mathcal{O}}\left(#1\right)%
    }%
}
\ExplSyntaxOff

% Integral Range
\newcommand{\intRange}[2]{[#1 \, ; \, #2]}


% Bounding Box
\ExplSyntaxOn
\NewDocumentCommand \bbox { m o }
{
    \IfNoValueTF{#2}{%
        \mathit{bB}(#1)%
    }%
    {%
        \mathit{bB}\sb{#2}(#1)%
    }%
}
\ExplSyntaxOff

% Convex Hull
\newcommand{\convh}[1]{\mathit{cHull}\left(#1\right)}
\newcommand{\vol}[1]{\mathit{vol}\left(#1\right)}



% Continuity
\newcommand{\Cont}{\mathcal{C}}

%====================================================================
% Input all math environements
\makeatletter
\@ifundefined{dontLoadMathEnv}{\input{style/MathEnvironments_impl}}{}
\makeatother


% Units ==============================================================
%\usepackage[squaren]{SIunits}
\usepackage{nicefrac}
\usepackage{units}
\usepackage[output-open-uncertainty=\pm,output-close-uncertainty=]{siunitx}
\newcommand{\sifrac}[1]{\si[per-mode=fraction]{#1}}
\newcommand{\sifracN}[2]{\unitfrac{\si[per-mode=symbol]{#1}}{\si[per-mode=symbol]{#2}}}
\newcommand{\numN}[1]{\num[scientific-notation=false]{#1}}
\newcommand{\numS}[1]{\num[scientific-notation=true]{#1}}
\newcommand{\SINumN}[2]{\SI[scientific-notation=false]{#1}{#2}}
\newcommand{\SINumS}[2]{\SI[scientific-notation=true]{#1}{#2}}